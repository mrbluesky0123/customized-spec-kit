# 시스템 명세: 카페 모바일 주문 시스템

**생성일**: 2025-11-29
**상태**: 초안
**입력**: 카페에서 모바일 주문을 처리하는 백엔드 시스템 구성 요구사항

> 문서 작성 언어: 한글 (필요 시 영어 전문 용어 단어 수준 허용). AI는 커밋을 수행하지 않으며 커밋 메시지 초안도 반드시 한글로 작성해야 합니다. 최종 커밋 메시지는 인간이 검토/수정 후 직접 커밋합니다.

## 프로젝트 개요 *(필수)*

### 프로젝트 목적

Spring Boot와 JPA 기반의 REST API 서버를 구축하여 카페 모바일 주문 시스템의 백엔드를 제공합니다. Java 11 이상의 환경에서 Controller-Service-Repository 레이어 아키텍처를 적용하고, PostgreSQL 데이터베이스와 연동하여 회원 관리 및 주문/결제 처리 기능을 구현합니다. 외부 결제 API는 Mock으로 구현하여 실패 상황을 시뮬레이션하고, 감사 로그는 LMS에 적재하여 CS 응대 및 감사 대응을 지원합니다.

### 시스템 범위

**포함**:
- Spring Boot 기반 REST API 서버 구현
- JPA를 통한 PostgreSQL 데이터베이스 접근
- 회원 가입/탈퇴/탈퇴 철회 API
- 상품 주문 및 주문 취소 API
- Mock 결제 API 연동 (지연 및 실패율 시뮬레이션)
- LMS 감사 로그 적재 기능
- 단위 테스트 작성 (JUnit 기반)
- JSON 기반 요청/응답 처리

**제외**:
- 프론트엔드 애플리케이션 (모바일 앱은 별도 구현)
- 실제 결제 게이트웨이 연동
- 상품 재고 관리 시스템
- POS 시스템 연동
- 어드민 페이지 및 EAM 연동
- 메시지 큐 또는 이벤트 기반 아키텍처

## 기술 스택 및 표준 *(필수)*

### 프로그래밍 언어 및 프레임워크

- **백엔드**: Java 11 이상, Spring Boot 2.7.x 이상
- **프론트엔드**: 해당없음 (웹뷰 기반 모바일 앱은 별도 구현)
- **모바일**: 해당없음 (별도 구현)

### 표준 서버 구성

- **맛간장 (자바 서버 표준)**: 미적용
  - 사유: 본 프로젝트는 엔터프라이즈급의 큰 시스템이 아니기 때문에 표준화된 SDK가 필요치 않음

### 데이터베이스

- **주 데이터베이스**: PostgreSQL (버전 12 이상 권장)
- **캐시**: 해당없음
- **검색엔진**: 해당없음

## 필수 기술 표준 적용 *(필수)*

### 감사 로그

- **LMS (카카오뱅크 감사로그 적재 시스템) 적재**: 적용
  - 사유: 감사 대응뿐만 아니라 시스템 관리자의 CS 응대를 위해서도 필요
  - 적재 대상:
    - 회원 가입 이벤트 (회원 ID, 가입 일시, 회원 정보)
    - 회원 탈퇴 이벤트 (회원 ID, 탈퇴 일시)
    - 회원 탈퇴 철회 이벤트 (회원 ID, 철회 일시)
    - 주문 생성 이벤트 (주문 ID, 회원 ID, 주문 일시, 상품 정보, 결제 금액)
    - 주문 취소 이벤트 (주문 ID, 회원 ID, 취소 일시, 취소 사유)
    - 결제 성공/실패 이벤트 (결제 ID, 주문 ID, 결제 일시, 결과)
    - 결제 취소 성공/실패 이벤트 (결제 취소 ID, 주문 ID, 취소 일시, 결과)

### 접근 제어

- **EAM (Enterprise Access Management) 적용**: 미적용
  - 사유: 어드민 페이지 없음

### 기타 표준

- JSON 형식의 요청/응답 처리 (Spring Boot의 기본 Jackson 사용)
- RESTful API 설계 원칙 준수
- 트랜잭션 관리는 Spring의 @Transactional 사용
- 예외 처리는 @ControllerAdvice를 통한 전역 예외 핸들러 구현

## 시스템 요구사항 *(필수)*

### 기능 요구사항

- **SR-001**: 시스템은 Java 11 이상, Spring Boot 2.7.x 이상으로 구현되어야 함
- **SR-002**: 데이터베이스 접근은 JPA를 사용하며, PostgreSQL과 연동되어야 함
- **SR-003**: 모든 API 요청과 응답은 JSON 형식으로 처리되어야 함
- **SR-004**: 회원 가입 시 전화번호 중복 검증 로직이 구현되어야 함
- **SR-005**: 회원 탈퇴 시 탈퇴 일시를 기록하고, 30일 이내 탈퇴 철회 가능 여부를 판단하는 로직이 구현되어야 함
- **SR-006**: 결제 처리는 Mock 서비스로 구현하며, 0~1초의 랜덤 지연과 1%의 실패율을 시뮬레이션해야 함
- **SR-007**: 주문 생성 시 결제가 성공한 경우에만 주문이 확정되어야 하며, 결제 실패 시 주문이 생성되지 않아야 함 (트랜잭션 롤백)
- **SR-008**: 주문 취소 시 결제 취소도 함께 처리되어야 하며, 결제 취소 실패 시 적절한 에러 처리가 이루어져야 함
- **SR-009**: 모든 주요 비즈니스 이벤트는 LMS에 감사 로그로 적재되어야 함
- **SR-010**: 각 기능(회원 가입, 탈퇴, 주문, 취소)에 대한 단위 테스트가 JUnit 기반으로 작성되어야 함

### 비기능 요구사항

#### 성능

- **SR-NFR-001**: 시스템은 결제 API 지연 시간을 고려하여 평균 응답 시간 2초 이내를 목표로 함
- **SR-NFR-002**: 데이터베이스 쿼리는 인덱스를 적절히 활용하여 최적화되어야 함 (예: 전화번호, 회원 ID, 주문 ID 등)

#### 보안

- **SR-NFR-003**: 회원의 개인정보(이름, 전화번호, 성별, 생년월일)는 데이터베이스에 안전하게 저장되어야 함
- **SR-NFR-004**: API 요청 시 적절한 입력 검증이 이루어져야 하며, SQL Injection 등의 보안 취약점이 없어야 함
- **SR-NFR-005**: 민감한 정보는 로그에 출력되지 않도록 주의해야 함 (예: 개인정보, 결제 정보 등)

#### 확장성

- **SR-NFR-006**: 시스템은 수평 확장이 가능하도록 설계되어야 하며, 로드 밸런서를 통해 다수의 인스턴스로 분산 처리 가능해야 함
- **SR-NFR-007**: 세션 관리는 Stateless 방식으로 구현되어야 함 (JWT 또는 토큰 기반 인증 권장)

## 시스템 아키텍처 *(필수)*

### 시스템 구성도

```
┌─────────────────────┐
│   모바일 앱          │ (웹뷰)
│   (Frontend)        │
└──────────┬──────────┘
           │ HTTPS
           ▼
┌─────────────────────┐
│   DMZ 프록시         │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│   채널 서버          │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│   로드 밸런서 (LB)   │
└──────────┬──────────┘
           │
           ├────────────┬────────────┬────────────┐
           ▼            ▼            ▼            ▼
    ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐
    │ 서버 #1  │ │ 서버 #2  │ │ 서버 #3  │ │ 서버 #n  │
    │          │ │          │ │          │ │          │
    │ ┌──────┐ │ │ ┌──────┐ │ │ ┌──────┐ │ │ ┌──────┐ │
    │ │Filter│ │ │ │Filter│ │ │ │Filter│ │ │ │Filter│ │
    │ └───┬──┘ │ │ └───┬──┘ │ │ └───┬──┘ │ │ └───┬──┘ │
    │     │    │ │     │    │ │     │    │ │     │    │
    │ ┌───▼────┐│ │ ┌───▼────┐│ │ ┌───▼────┐│ │ ┌───▼────┐│
    │ │Intercep││ │ │Intercep││ │ │Intercep││ │ │Intercep││
    │ │tor     ││ │ │tor     ││ │ │tor     ││ │ │tor     ││
    │ └───┬────┘│ │ └───┬────┘│ │ └───┬────┘│ │ └───┬────┘│
    │     │    │ │     │    │ │     │    │ │     │    │
    │ ┌───▼────┐│ │ ┌───▼────┐│ │ ┌───▼────┐│ │ ┌───▼────┐│
    │ │Control-││ │ │Control-││ │ │Control-││ │ │Control-││
    │ │ler     ││ │ │ler     ││ │ │ler     ││ │ │ler     ││
    │ └───┬────┘│ │ └───┬────┘│ │ └───┬────┘│ │ └───┬────┘│
    │     │    │ │     │    │ │     │    │ │     │    │
    │ ┌───▼────┐│ │ ┌───▼────┐│ │ ┌───▼────┐│ │ ┌───▼────┐│
    │ │Service ││ │ │Service ││ │ │Service ││ │ │Service ││
    │ └───┬────┘│ │ └───┬────┘│ │ └───┬────┘│ │ └───┬────┘│
    │     │    │ │     │    │ │     │    │ │     │    │
    │ ┌───▼────┐│ │ ┌───▼────┐│ │ ┌───▼────┐│ │ ┌───▼────┐│
    │ │Reposito││ │ │Reposito││ │ │Reposito││ │ │Reposito││
    │ │ry      ││ │ │ry      ││ │ │ry      ││ │ │ry      ││
    │ └───┬────┘│ │ └───┬────┘│ │ └───┬────┘│ │ └───┬────┘│
    │     │    │ │     │    │ │     │    │ │     │    │
    │ ┌───▼────┐│ │ ┌───▼────┐│ │ ┌───▼────┐│ │ ┌───▼────┐│
    │ │ DAO    ││ │ │ DAO    ││ │ │ DAO    ││ │ │ DAO    ││
    │ └───┬────┘│ │ └───┬────┘│ │ └───┬────┘│ │ └───┬────┘│
    └─────┼─────┘ └─────┼─────┘ └─────┼─────┘ └─────┼─────┘
          │             │             │             │
          └──────┬──────┴──────┬──────┴──────┬──────┘
                 │             │             │
                 ▼             ▼             ▼
          ┌─────────────────────────────────┐
          │   PostgreSQL Database           │
          │   (회원, 상품, 주문 데이터)      │
          └─────────────────────────────────┘

각 서버에서 외부 연동:
          │
          ├─────────────────────────────┐
          │                             │
          ▼                             ▼
┌─────────────────────┐       ┌─────────────────────┐
│  결제 API (Mock)     │       │  LMS                │
│  - 랜덤 지연 (0~1초) │       │  (감사 로그 적재)    │
│  - 1% 실패율         │       │                     │
└─────────────────────┘       └─────────────────────┘
```

### 주요 컴포넌트

- **Filter**: 요청 전처리 및 후처리 담당 (로깅, 인코딩, 보안 필터 등)
  - CorsFilter: CORS 정책 처리
  - LoggingFilter: 요청/응답 로깅
- **Interceptor**: 컨트롤러 전후 처리 담당 (인증, 권한 검증 등)
  - AuthenticationInterceptor: 회원 인증 확인
  - AuditLogInterceptor: 감사 로그 수집 준비
- **Controller**: REST API 엔드포인트 제공 및 요청/응답 처리
  - MemberController: 회원 가입, 탈퇴, 탈퇴 철회 API
  - OrderController: 주문 생성, 주문 취소 API
  - ProductController: 상품 조회 API (선택적)
- **Service**: 비즈니스 로직 처리 및 트랜잭션 관리
  - MemberService: 회원 관리 비즈니스 로직
  - OrderService: 주문 및 결제 처리 비즈니스 로직
  - PaymentService: Mock 결제 처리 및 결제 취소 로직
  - AuditLogService: LMS 감사 로그 적재 로직
- **Repository**: JPA 기반 데이터 접근 인터페이스
  - MemberRepository: 회원 엔티티 CRUD
  - OrderRepository: 주문 엔티티 CRUD
  - ProductRepository: 상품 엔티티 CRUD
- **DAO (Data Access Object)**: Repository의 구현체 (JPA 사용 시 자동 생성)
  - JPA가 자동으로 구현체를 제공하므로 별도 구현 불필요
- **Entity**: JPA 엔티티 클래스
  - Member: 회원 정보 (ID, 이름, 전화번호, 성별, 생년월일, 가입일시, 탈퇴일시, 상태)
  - Order: 주문 정보 (ID, 회원 ID, 상품 ID, 주문 수량, 총 금액, 주문 일시, 주문 상태)
  - Product: 상품 정보 (ID, 상품명, 가격, 설명)
  - Payment: 결제 정보 (ID, 주문 ID, 결제 금액, 결제 일시, 결제 상태)

### 외부 시스템 연동

- **결제 API (Mock)**: 결제 처리 및 결제 취소를 시뮬레이션하는 Mock 서비스
  - 연동 방식: Spring Bean으로 구현된 PaymentMockService
  - 기능: 0~1초의 랜덤 지연 후 99% 확률로 성공, 1% 확률로 실패 응답
  - 실패 처리: 결제 실패 시 주문 트랜잭션 롤백, 에러 메시지 반환
- **LMS (카카오뱅크 감사로그 적재 시스템)**: 감사 로그 적재
  - 연동 방식: LMS SDK 또는 REST API를 통한 비동기 로그 전송
  - 적재 시점: 주요 비즈니스 이벤트 발생 시 (회원 가입, 탈퇴, 주문, 결제 등)
  - 실패 처리: 로그 적재 실패 시 재시도 또는 로컬 로그 파일에 백업

## 성공 기준 *(필수)*

### 기술적 목표

- **SC-001**: Java 11 이상, Spring Boot 2.7.x 이상으로 구현된 실행 가능한 JAR 파일 생성
- **SC-002**: PostgreSQL 데이터베이스와 JPA를 통한 정상적인 CRUD 동작 확인
- **SC-003**: 모든 API가 JSON 형식으로 요청/응답을 처리하며, RESTful 설계 원칙을 준수
- **SC-004**: 결제 Mock 서비스가 지정된 지연 시간(0~1초)과 실패율(1%)로 동작
- **SC-005**: LMS 감사 로그 적재가 정상적으로 이루어지며, 주요 이벤트가 누락 없이 기록됨
- **SC-006**: 각 기능에 대한 단위 테스트가 작성되어 있으며, 테스트 커버리지 80% 이상 달성
- **SC-007**: ERD(Entity Relationship Diagram)가 생성되어 시스템의 데이터 구조를 명확히 표현
- **SC-008**: API 명세서가 작성되어 모든 엔드포인트, 요청/응답 형식, 에러 코드가 문서화됨

### 검증 방법

- **SC-001 검증**: `./gradlew bootJar` 또는 `mvn package` 명령으로 JAR 파일 생성 확인, `java -jar` 명령으로 실행 가능 여부 확인
- **SC-002 검증**: 애플리케이션 실행 후 회원 가입, 조회, 수정, 탈퇴 API 호출하여 데이터베이스에 정상 반영되는지 확인
- **SC-003 검증**: Postman 또는 curl을 통해 각 API 호출 시 JSON 형식의 요청/응답 확인, HTTP 메서드 및 상태 코드가 RESTful 원칙에 부합하는지 검증
- **SC-004 검증**: 결제 API를 100회 이상 호출하여 평균 지연 시간이 0~1초 범위 내에 있고, 실패율이 약 1% 수준인지 통��적으로 확인
- **SC-005 검증**: LMS 로그 저장소 또는 로그 파일을 확인하여 회원 가입, 주문, 결제 등의 이벤트가 누락 없이 기록되었는지 검증
- **SC-006 검증**: JUnit 테스트 실행 후 테스트 결과 리포트 확인, 코드 커버리지 도구(JaCoCo)를 사용하여 커버리지 측정
- **SC-007 검증**: ERD 문서 존재 확인, Entity 간 관계(1:N, N:M 등)가 명확히 표현되어 있는지 검토
- **SC-008 검증**: API 명세서 문서 존재 확인, 각 API의 엔드포인트, HTTP 메서드, 요청/응답 예시, 에러 코드가 명시되어 있는지 검토
